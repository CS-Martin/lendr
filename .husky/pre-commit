#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo 'ğŸ‘·â€â™‚ï¸ Starting pre-commit checks...'

# Run checks in /api
echo 'ğŸ“¦ Checking /api...'
cd api || exit 1

echo 'ğŸ§¹ Linting API service...'
npm run lint
if [ $? -ne 0 ]; then
  echo 'âŒ Lint failed in /api. Please fix the issues above and try committing again.'
  exit 1
fi

echo 'ğŸ¨ Formatting API service...'
npm run format
if [ $? -ne 0 ]; then
  echo 'âŒ Format failed in /api. Please fix the issues above and try committing again.'
  exit 1
fi

cd ..

# Run checks in /client
echo 'ğŸ“¦ Checking /client...'
cd client || exit 1

echo 'ğŸ§¹ Linting client app...'
npm run lint
if [ $? -ne 0 ]; then
  echo 'âŒ Lint failed in /client. Please fix the issues above and try committing again.'
  exit 1
fi

echo 'ğŸ¨ Formatting client app...'
npm run format
if [ $? -ne 0 ]; then
  echo 'âŒ Format failed in /client. Please fix the issues above and try committing again.'
  exit 1
fi

cd ..

echo 'âœ… All checks passed. Proceeding with commit. ğŸš€'
