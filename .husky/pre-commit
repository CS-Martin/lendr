echo 'ğŸ‘·â€â™‚ï¸ Starting pre-commit checks...'

STAGED_FILES=$(git diff --cached --name-only)
echo 'ğŸ” Staged files:'
echo "$STAGED_FILES"

HAS_API_CHANGES=$(echo "$STAGED_FILES" | grep -E '^api/' || true)
HAS_CLIENT_CHANGES=$(echo "$STAGED_FILES" | grep -E '^client/' || true)

if [ -n "$HAS_API_CHANGES" ]; then
  echo 'ğŸ“¦ Changes detected in /api...'
  cd api || exit 1

  echo 'ğŸ§¹ Linting API service...'
  npm run lint || exit 1

  echo 'ğŸ¨ Formatting API service...'
  npm run format || exit 1

  cd ..
fi

if [ -n "$HAS_CLIENT_CHANGES" ]; then
  echo 'ğŸ“¦ Changes detected in /client...'
  cd client || exit 1

  echo 'ğŸ§¹ Linting client app...'
  npm run lint || exit 1

  echo 'ğŸ¨ Formatting client app...'
  npm run format || exit 1

  cd ..
fi

echo 'âœ… All relevant checks passed. Proceeding with commit. ğŸš€'
exit 0
